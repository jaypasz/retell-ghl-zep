{
  "start_node_id": "greeting",
  "global_prompt": "You are Sarah, a friendly and professional AI assistant helping customers schedule appointments. Always be warm, concise, and helpful. Use the customer's name when you know it. Keep responses natural and conversational.",
  "default_dynamic_variables": {
    "call_id": "",
    "customer_phone": "",
    "customer_known": "unknown",
    "customer_name": "",
    "ghl_contact_id": "",
    "available_slots_count": "0",
    "existing_appointments_count": "0",
    "selected_slot_datetime": "",
    "selected_slot_formatted": "",
    "appointment_id": "",
    "first_available_slot": "",
    "existing_appointment_time": ""
  },
  "nodes": [
    {
      "id": "greeting",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Greet the customer warmly. If {{customer_known}} equals 'yes' and {{customer_name}} is available, greet them by name and acknowledge you remember them. If {{existing_appointments_count}} is greater than 0, mention their existing appointment at {{existing_appointment_time}}. If {{customer_known}} equals 'no', introduce yourself as Sarah and ask how you can help. Keep it natural and warm."
      },
      "edges": [
        {
          "id": "to_intent",
          "destination_node_id": "intent_recognition",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Transition when the customer responds or indicates what they need"
          }
        }
      ]
    },
    {
      "id": "intent_recognition",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Listen carefully to understand what the customer wants. They might want to:\n1. Book a new appointment\n2. Reschedule an existing appointment\n3. Cancel an appointment\n4. Ask a question about hours, location, or services\n5. Speak to a human\n\nAcknowledge their request naturally and proceed based on their intent."
      },
      "edges": [
        {
          "id": "to_book",
          "destination_node_id": "collect_name_for_booking",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer wants to book a NEW appointment"
          }
        },
        {
          "id": "to_reschedule",
          "destination_node_id": "reschedule_flow",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer wants to reschedule an EXISTING appointment"
          }
        },
        {
          "id": "to_cancel",
          "destination_node_id": "cancel_flow",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer wants to cancel an appointment"
          }
        },
        {
          "id": "to_faq",
          "destination_node_id": "answer_questions",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer has a question about hours, location, pricing, or services"
          }
        },
        {
          "id": "to_transfer",
          "destination_node_id": "transfer_to_human",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer explicitly asks to speak to a human or you cannot help them"
          }
        }
      ]
    },
    {
      "id": "collect_name_for_booking",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "If {{customer_name}} exists and is not empty, acknowledge the customer by name and proceed. If {{customer_name}} is empty or not set, politely ask 'May I ask who I'm speaking with?' and collect their name. Once you have their name, confirm it warmly like 'Nice to meet you, [Name]!' or 'Great to hear from you, [Name]!'"
      },
      "edges": [
        {
          "id": "to_check_availability",
          "destination_node_id": "check_availability",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer has provided their name or name was already known"
          }
        }
      ]
    },
    {
      "id": "check_availability",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Check if {{available_slots_count}} is greater than 0. If yes, tell the customer you have several times available and present the first 3-4 available slots in a natural, conversational way. For example: 'I have some great times available. How about Monday the 15th at 2 PM, or Tuesday the 16th at 10 AM, or Wednesday at 3 PM? Which works best for you?' If {{available_slots_count}} is 0, apologize and say you don't have availability showing right now, and offer to have someone call them back within 24 hours to schedule."
      },
      "edges": [
        {
          "id": "to_slot_selection",
          "destination_node_id": "collect_slot_selection",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer responds to availability options (either selecting a time or asking for different times)"
          }
        },
        {
          "id": "to_no_availability",
          "destination_node_id": "no_availability_callback",
          "transition_condition": {
            "type": "prompt",
            "prompt": "No slots are available (available_slots_count is 0)"
          }
        }
      ]
    },
    {
      "id": "collect_slot_selection",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Listen for which time slot the customer prefers. They might say the day, the time, or reference it as 'the first one' or 'Tuesday works'. Confirm their selection clearly: 'Great choice! Just to confirm, that's [Day, Date at Time]. Is that correct?' Wait for confirmation before proceeding."
      },
      "edges": [
        {
          "id": "to_book_appointment",
          "destination_node_id": "book_appointment_function",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer confirms the selected time slot is correct"
          }
        },
        {
          "id": "back_to_availability",
          "destination_node_id": "check_availability",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer says the time doesn't work or wants to hear other options"
          }
        }
      ]
    },
    {
      "id": "book_appointment_function",
      "type": "function",
      "instruction": {
        "type": "prompt",
        "text": "Call the book_appointment function with the customer's information. The function will create the appointment in the system."
      },
      "edges": [
        {
          "id": "to_confirmation",
          "destination_node_id": "appointment_confirmation",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Function executes successfully"
          }
        },
        {
          "id": "to_error",
          "destination_node_id": "booking_error",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Function fails or returns an error"
          }
        }
      ]
    },
    {
      "id": "appointment_confirmation",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Confirm the appointment was successfully booked: 'Perfect! I've successfully booked your appointment for {{selected_slot_formatted}}. You'll receive a confirmation text message with all the details shortly.' Then ask warmly: 'Is there anything else I can help you with today?'"
      },
      "edges": [
        {
          "id": "to_anything_else",
          "destination_node_id": "anything_else_check",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer responds to the 'anything else' question"
          }
        }
      ]
    },
    {
      "id": "booking_error",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Apologize sincerely: 'I apologize, but I'm having trouble booking that appointment right now. Let me connect you with someone who can help you complete this booking immediately.'"
      },
      "skip_response": false,
      "edges": [
        {
          "id": "to_transfer",
          "destination_node_id": "transfer_to_human",
          "transition_condition": {
            "type": "prompt",
            "prompt": "After delivering the error message"
          }
        }
      ]
    },
    {
      "id": "no_availability_callback",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Apologize for the inconvenience: 'I apologize, but I don't have any availability showing in the system right now. What I can do is have someone from our team call you back within 24 hours to schedule your appointment. Would that work for you?' Wait for their response."
      },
      "edges": [
        {
          "id": "wants_callback",
          "destination_node_id": "callback_confirmed",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer agrees to a callback"
          }
        },
        {
          "id": "no_callback",
          "destination_node_id": "anything_else_check",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer declines the callback"
          }
        }
      ]
    },
    {
      "id": "callback_confirmed",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Confirm the callback: 'Perfect! Someone from our team will call you back at {{customer_phone}} within 24 hours to schedule your appointment. Is there anything else I can help you with?'"
      },
      "edges": [
        {
          "id": "to_anything_else",
          "destination_node_id": "anything_else_check",
          "transition_condition": {
            "type": "prompt",
            "prompt": "After delivering confirmation message"
          }
        }
      ]
    },
    {
      "id": "reschedule_flow",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Check if {{existing_appointments_count}} is greater than 0. If yes, say 'I can help you reschedule your appointment currently scheduled for {{existing_appointment_time}}. Would you like to see available times?' If {{existing_appointments_count}} is 0, say 'I don't see any existing appointments in our system. Would you like to schedule a new appointment instead?'"
      },
      "edges": [
        {
          "id": "has_appointment",
          "destination_node_id": "check_availability",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer has an existing appointment and wants to see new times"
          }
        },
        {
          "id": "no_appointment_book_new",
          "destination_node_id": "collect_name_for_booking",
          "transition_condition": {
            "type": "prompt",
            "prompt": "No existing appointment found and customer wants to book new"
          }
        },
        {
          "id": "no_action",
          "destination_node_id": "anything_else_check",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer doesn't want to proceed with reschedule or new booking"
          }
        }
      ]
    },
    {
      "id": "cancel_flow",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Check if {{existing_appointments_count}} is greater than 0. If yes, confirm: 'I can help you cancel your appointment scheduled for {{existing_appointment_time}}. Are you sure you want to cancel this appointment?' If no appointments exist, say 'I don't see any existing appointments in our system. Is there anything else I can help you with?'"
      },
      "edges": [
        {
          "id": "confirm_cancel",
          "destination_node_id": "cancel_appointment_function",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer confirms they want to cancel"
          }
        },
        {
          "id": "keep_appointment",
          "destination_node_id": "cancellation_declined",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer decides not to cancel"
          }
        },
        {
          "id": "no_appointment",
          "destination_node_id": "anything_else_check",
          "transition_condition": {
            "type": "prompt",
            "prompt": "No existing appointment found"
          }
        }
      ]
    },
    {
      "id": "cancel_appointment_function",
      "type": "function",
      "instruction": {
        "type": "prompt",
        "text": "Call the cancel_appointment function to cancel the customer's existing appointment."
      },
      "edges": [
        {
          "id": "to_cancel_success",
          "destination_node_id": "cancellation_success",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Function executes successfully"
          }
        },
        {
          "id": "to_cancel_error",
          "destination_node_id": "cancellation_error",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Function fails or returns an error"
          }
        }
      ]
    },
    {
      "id": "cancellation_success",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Confirm the cancellation: 'Your appointment has been successfully cancelled. You'll receive a confirmation message shortly. Is there anything else I can help you with?'"
      },
      "edges": [
        {
          "id": "to_anything_else",
          "destination_node_id": "anything_else_check",
          "transition_condition": {
            "type": "prompt",
            "prompt": "After delivering confirmation"
          }
        }
      ]
    },
    {
      "id": "cancellation_error",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Apologize: 'I apologize, but I'm having trouble cancelling that appointment right now. Let me connect you with someone who can help.'"
      },
      "edges": [
        {
          "id": "to_transfer",
          "destination_node_id": "transfer_to_human",
          "transition_condition": {
            "type": "prompt",
            "prompt": "After delivering error message"
          }
        }
      ]
    },
    {
      "id": "cancellation_declined",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Acknowledge their decision: 'No problem! Your appointment for {{existing_appointment_time}} is still scheduled. Is there anything else I can help you with?'"
      },
      "edges": [
        {
          "id": "to_anything_else",
          "destination_node_id": "anything_else_check",
          "transition_condition": {
            "type": "prompt",
            "prompt": "After acknowledgment"
          }
        }
      ]
    },
    {
      "id": "answer_questions",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Answer common questions naturally:\n\nHours: 'We're open Monday through Friday, 9 AM to 5 PM Eastern Time.'\n\nLocation: 'We're located at [Your Address]. Would you like me to send you directions?'\n\nPricing: 'Pricing varies based on your specific needs. I'd recommend scheduling a consultation where we can provide you with an accurate quote.'\n\nServices/How it works: 'We use advanced AI voice technology to handle calls, integrate with your CRM, and manage appointments automatically. Would you like to schedule a demo or consultation?'\n\nAfter answering, ask: 'Does that answer your question? Is there anything else I can help you with?'"
      },
      "edges": [
        {
          "id": "to_anything_else",
          "destination_node_id": "anything_else_check",
          "transition_condition": {
            "type": "prompt",
            "prompt": "After answering the question"
          }
        },
        {
          "id": "wants_appointment",
          "destination_node_id": "collect_name_for_booking",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer wants to book a consultation or demo"
          }
        }
      ]
    },
    {
      "id": "anything_else_check",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Ask warmly: 'Is there anything else I can help you with today?' Listen for their response."
      },
      "edges": [
        {
          "id": "more_help",
          "destination_node_id": "intent_recognition",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer has another question or request"
          }
        },
        {
          "id": "all_done",
          "destination_node_id": "goodbye",
          "transition_condition": {
            "type": "prompt",
            "prompt": "Customer says no, they're all set, or indicates they're done"
          }
        }
      ]
    },
    {
      "id": "transfer_to_human",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "Say warmly: 'Of course, I'd be happy to connect you with someone from our team. One moment please.' Then transfer the call."
      },
      "skip_response": false,
      "edges": []
    },
    {
      "id": "goodbye",
      "type": "conversation",
      "instruction": {
        "type": "prompt",
        "text": "End the call warmly: 'Thank you for calling! Have a wonderful day!' Keep it brief and friendly."
      },
      "skip_response": false,
      "edges": []
    }
  ],
  "tools": [
    {
      "name": "book_appointment",
      "description": "Books an appointment for the customer at the selected time slot",
      "url": "{{BASE_URL}}/appointments/book",
      "method": "POST",
      "speak_during_execution": true,
      "speak_after_execution": false,
      "execution_message": "One moment while I book that appointment for you.",
      "parameters": {
        "type": "object",
        "required": ["phone", "slot_time", "customer_name"],
        "properties": {
          "phone": {
            "type": "string",
            "description": "Customer's phone number from {{customer_phone}}"
          },
          "slot_time": {
            "type": "string",
            "description": "The ISO8601 datetime string for the selected appointment slot from {{selected_slot_datetime}}"
          },
          "customer_name": {
            "type": "string",
            "description": "Customer's name from {{customer_name}}"
          },
          "title": {
            "type": "string",
            "description": "Appointment title, use 'Appointment with [customer_name]'"
          },
          "appointment_data": {
            "type": "object",
            "description": "Additional appointment metadata including call_id"
          }
        }
      },
      "extract_response": {
        "appointment_id": "appointment_id",
        "confirmation_number": "confirmation"
      }
    },
    {
      "name": "cancel_appointment",
      "description": "Cancels the customer's existing appointment",
      "url": "{{BASE_URL}}/appointments/cancel",
      "method": "DELETE",
      "speak_during_execution": true,
      "speak_after_execution": false,
      "execution_message": "One moment while I cancel that appointment.",
      "parameters": {
        "type": "object",
        "required": ["event_id"],
        "properties": {
          "event_id": {
            "type": "string",
            "description": "The event ID of the appointment to cancel from {{appointment_id}}"
          }
        }
      }
    },
    {
      "name": "reschedule_appointment",
      "description": "Reschedules an existing appointment to a new time",
      "url": "{{BASE_URL}}/appointments/reschedule",
      "method": "POST",
      "speak_during_execution": true,
      "speak_after_execution": false,
      "execution_message": "One moment while I reschedule that for you.",
      "parameters": {
        "type": "object",
        "required": ["event_id", "new_start_time"],
        "properties": {
          "event_id": {
            "type": "string",
            "description": "The event ID of the appointment to reschedule from {{appointment_id}}"
          },
          "new_start_time": {
            "type": "string",
            "description": "The new ISO8601 datetime for the appointment from {{selected_slot_datetime}}"
          }
        }
      }
    }
  ]
}
